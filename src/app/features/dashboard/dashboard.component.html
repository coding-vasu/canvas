<div
  class="h-screen w-screen flex overflow-hidden bg-obsidian font-mono text-text-primary selection:bg-indigo-500 selection:text-white"
  [class.x-ray-mode]="isXRayMode()"
>
  <!-- Left Sidebar (Project & Context) -->
  <aside
    class="relative z-30 flex flex-col border-r border-glass-border bg-[#13161C] transition-all duration-300 ease-in-out"
    [class.w-64]="isLeftSidebarOpen()"
    [class.w-16]="!isLeftSidebarOpen()"
  >
    <!-- Header -->
    <div class="h-14 flex items-center justify-between px-4 border-b border-glass-border">
      @if (isLeftSidebarOpen()) {
        <span class="font-bold tracking-tight text-white truncate">PROJECT A</span>
      }
      <p-button
        [icon]="isLeftSidebarOpen() ? 'pi pi-angle-left' : 'pi pi-angle-right'"
        styleClass="!p-1 !w-8 !h-8 !border-0 !bg-transparent !text-text-secondary hover:!text-white"
        (click)="toggleLeftSidebar()"
      />
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto p-2 space-y-2">
      @if (isLeftSidebarOpen()) {
        <!-- Tree View Placeholder -->
        <div class="text-xs font-medium text-text-secondary px-2 py-2">LAYERS</div>
        <div
          class="group flex items-center gap-2 px-2 py-1.5 rounded hover:bg-white/5 cursor-pointer text-sm text-text-secondary hover:text-white"
        >
          <i class="pi pi-box size-3"></i>
          <span>Hero Section</span>
        </div>
        <div
          class="group flex items-center gap-2 px-2 py-1.5 rounded hover:bg-white/5 cursor-pointer text-sm text-text-secondary hover:text-white"
        >
          <i class="pi pi-image size-3"></i>
          <span>Main Image</span>
        </div>
      } @else {
        <!-- Collapsed Icons -->
        <div class="flex flex-col items-center gap-4 pt-4">
          <i
            class="pi pi-box text-text-secondary hover:text-white cursor-pointer"
            pTooltip="Layers"
          ></i>
          <i
            class="pi pi-images text-text-secondary hover:text-white cursor-pointer"
            pTooltip="Assets"
          ></i>
        </div>
      }
    </div>

    <!-- Footer (User) -->
    <div class="p-4 border-t border-glass-border">
      <div class="flex items-center gap-3">
        <p-avatar
          icon="pi pi-user"
          shape="circle"
          styleClass="!w-8 !h-8 !bg-indigo-500/20 !text-indigo-300 !border !border-indigo-500/30"
        />
        @if (isLeftSidebarOpen()) {
          <div class="flex flex-col overflow-hidden">
            <span class="text-xs font-medium text-white truncate" [title]="userName()">{{
              userName()
            }}</span>
            <button
              (click)="onLogout()"
              class="text-[10px] text-text-secondary hover:text-red-400 text-left transition-colors"
            >
              Sign Out
            </button>
          </div>
        }
      </div>
    </div>
  </aside>

  <!-- Main Canvas Area -->
  <main
    class="flex-1 relative overflow-hidden bg-obsidian cursor-grab active:cursor-grabbing"
    (mousedown)="startPan($event)"
    (mousemove)="pan($event)"
    (mouseup)="endPan()"
    (mouseleave)="endPan()"
    (wheel)="onWheel($event)"
  >
    <!-- Dot Grid Background -->
    <div
      class="absolute inset-0 bg-dot-grid opacity-20 pointer-events-none z-0"
      [style.backgroundPosition]="panOffset().x + 'px ' + panOffset().y + 'px'"
    ></div>

    <!-- Canvas Transform Layer -->
    <div
      class="absolute inset-0 origin-center will-change-transform z-10 flex items-center justify-center pointer-events-none"
      [style.transform]="canvasTransform()"
    >
      @if (isGenerating()) {
        <!-- Wireframe Skeleton -->
        <div
          class="w-[800px] h-[600px] border-2 border-dashed border-glass-border rounded-lg p-8 space-y-8 relative overflow-hidden"
        >
          <!-- Shimmer Overlay -->
          <div
            class="absolute inset-0 bg-linear-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_1.5s_infinite]"
          ></div>

          <!-- Skeleton Elements -->
          <div class="h-12 w-1/3 bg-white/5 rounded"></div>
          <div class="grid grid-cols-3 gap-6">
            <div class="h-48 bg-white/5 rounded"></div>
            <div class="h-48 bg-white/5 rounded"></div>
            <div class="h-48 bg-white/5 rounded"></div>
          </div>
          <div class="h-64 w-full bg-white/5 rounded"></div>
        </div>
      } @else {
        <!-- Example Generated Content Placeholder -->
        <div
          class="w-[800px] h-[600px] bg-[#1a1d24] border border-glass-border rounded-lg shadow-2xl flex items-center justify-center p-8"
        >
          <div class="text-center space-y-4">
            <div class="inline-flex p-4 rounded-full bg-white/5 mb-2">
              <i class="pi pi-sparkles text-teal-500 text-2xl"></i>
            </div>
            <h3 class="text-xl font-medium text-white">Ready to Design</h3>
            <p class="text-text-secondary max-w-sm">
              Use the prompt bar below to generate UI components or layout structures.
            </p>
          </div>
        </div>
      }
    </div>

    <!-- Floating Prompt Island -->
    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-2xl px-4">
      <div
        class="relative flex items-center gap-2 p-2 pl-4 bg-obsidian/60 hover:bg-obsidian/80 backdrop-blur-xl border border-white/10 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.5)] transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500/50 focus-within:border-indigo-500"
      >
        <i class="pi pi-sparkles text-teal-500 text-lg animate-pulse"></i>
        <input
          type="text"
          [(ngModel)]="promptText"
          (keydown.enter)="toggleGenerate()"
          placeholder="Describe your UI..."
          class="flex-1 bg-transparent border-0 outline-none text-white placeholder-text-secondary text-base font-sans h-10"
        />
        <div class="flex items-center gap-1 pr-1">
          <button
            class="p-2 rounded-full text-text-secondary hover:text-white hover:bg-white/5 transition-colors"
          >
            <i class="pi pi-paperclip"></i>
          </button>
          <button
            class="p-2 rounded-full text-text-secondary hover:text-white hover:bg-white/5 transition-colors"
          >
            <i class="pi pi-microphone"></i>
          </button>
          <button
            (click)="toggleGenerate()"
            [class.animate-pulse]="isGenerating()"
            class="ml-2 w-10 h-10 rounded-full bg-teal-500 hover:bg-teal-400 text-obsidian flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 cursor-pointer"
          >
            <i class="pi pi-sparkles font-bold"></i>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Right Panel (Properties & Code) -->
  <aside
    class="relative z-30 flex flex-col border-l border-glass-border bg-[#13161C] transition-all duration-300 ease-in-out"
    [class.w-80]="isRightPanelOpen()"
    [class.w-0]="!isRightPanelOpen()"
    [class.border-l-0]="!isRightPanelOpen()"
  >
    <!-- Toggle Button (Absolute when closed) -->
    @if (!isRightPanelOpen()) {
      <button
        (click)="toggleRightPanel()"
        class="absolute top-4 -left-10 w-8 h-8 flex items-center justify-center bg-[#13161C] border border-glass-border border-r-0 rounded-l-md text-text-secondary hover:text-white"
      >
        <i class="pi pi-angle-left"></i>
      </button>
    }

    <!-- Header -->
    <div
      class="h-14 flex items-center justify-between px-4 border-b border-glass-border overflow-hidden"
    >
      <div class="flex bg-obsidian/50 p-1 rounded-lg border border-glass-border">
        <button
          (click)="setMode('design')"
          [class.bg-indigo-500]="activeMode() === 'design'"
          [class.text-white]="activeMode() === 'design'"
          [class.text-text-secondary]="activeMode() !== 'design'"
          class="px-3 py-1 rounded text-xs font-medium transition-all"
        >
          Design
        </button>
        <button
          (click)="setMode('code')"
          [class.bg-indigo-500]="activeMode() === 'code'"
          [class.text-white]="activeMode() === 'code'"
          [class.text-text-secondary]="activeMode() !== 'code'"
          class="px-3 py-1 rounded text-xs font-medium transition-all"
        >
          Code
        </button>
      </div>
      <button (click)="toggleRightPanel()" class="text-text-secondary hover:text-white p-1">
        <i class="pi pi-times"></i>
      </button>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto overflow-x-hidden">
      @if (activeMode() === 'design') {
        <div class="p-4 space-y-6">
          <!-- Alignment -->
          <div class="space-y-3">
            <div class="text-xs text-text-secondary font-medium">ALIGNMENT</div>
            <div class="flex justify-between bg-obsidian p-1 rounded border border-glass-border">
              <button class="p-1 text-text-secondary hover:text-white">
                <i class="pi pi-align-left"></i>
              </button>
              <button class="p-1 text-text-secondary hover:text-white">
                <i class="pi pi-align-center"></i>
              </button>
              <button class="p-1 text-text-secondary hover:text-white">
                <i class="pi pi-align-right"></i>
              </button>
              <button class="p-1 text-text-secondary hover:text-white">
                <i class="pi pi-align-justify"></i>
              </button>
            </div>
          </div>

          <!-- Properties -->
          <div class="space-y-3">
            <div class="text-xs text-text-secondary font-medium">PROPERTIES</div>
            <div class="grid grid-cols-2 gap-3">
              <div class="space-y-1">
                <span class="text-[10px] text-text-secondary">X</span>
                <input
                  type="text"
                  value="0"
                  class="w-full bg-obsidian border border-glass-border rounded px-2 py-1 text-xs text-white focus:border-indigo-500 outline-none font-mono"
                />
              </div>
              <div class="space-y-1">
                <span class="text-[10px] text-text-secondary">Y</span>
                <input
                  type="text"
                  value="0"
                  class="w-full bg-obsidian border border-glass-border rounded px-2 py-1 text-xs text-white focus:border-indigo-500 outline-none font-mono"
                />
              </div>
              <div class="space-y-1">
                <span class="text-[10px] text-text-secondary">W</span>
                <input
                  type="text"
                  value="800"
                  class="w-full bg-obsidian border border-glass-border rounded px-2 py-1 text-xs text-white focus:border-indigo-500 outline-none font-mono"
                />
              </div>
              <div class="space-y-1">
                <span class="text-[10px] text-text-secondary">H</span>
                <input
                  type="text"
                  value="600"
                  class="w-full bg-obsidian border border-glass-border rounded px-2 py-1 text-xs text-white focus:border-indigo-500 outline-none font-mono"
                />
              </div>
            </div>
          </div>
        </div>
      } @else {
        <!-- Code Mode -->
        <div class="h-full bg-black p-4 font-mono text-xs">
          <div class="text-green-400">// Generated Component</div>
          <div class="text-purple-400 mt-2">&#64;Component({{ '{' }}</div>
          <div class="pl-4 text-blue-300">
            selector: <span class="text-orange-300">'app-demo'</span>,
          </div>
          <div class="pl-4 text-blue-300">
            standalone: <span class="text-indigo-400">true</span>,
          </div>
          <div class="pl-4 text-blue-300">template: `</div>
          <div class="pl-8 text-text-secondary">
            &lt;div class="container"&gt;<br />
            &nbsp;&nbsp;...<br />
            &lt;/div&gt;
          </div>
          <div class="pl-4 text-blue-300">`</div>
          <div class="text-purple-400">{{ '}' }})</div>
          <div class="text-purple-400 mt-4">
            export class <span class="text-yellow-300">DemoComponent</span> {{ '{' }}{{ '}' }}
          </div>
        </div>
      }
    </div>
  </aside>
</div>
